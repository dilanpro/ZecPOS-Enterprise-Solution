{% extends "layouts/app-layout.html" %}
{% load static %}


{% block content %}

    <div onclick="history.back()" class="hidden fixed left-0 md:flex items-center p-3 cursor-pointer">
        <img class="w-4 h-4 mx-2" src="{% static 'img/back.svg' %}" alt="">
        Back
    </div>

    <div class="flex flex-col items-center w-full">

        <!-- GRN Info -->
        <div class="flex flex-col md:flex-row items-center justify-start w-11/12 max-w-[700px] bg-light my-2 rounded-xl p-5">
            <div class="flex items-center justify-center w-[150px] h-[150px] bg-primary rounded-full">
                <img class="w-20 h-20" src="/static/img/grn-light.svg" alt="">
            </div>

            <div class="text-center md:text-start p-5 w-full">
                <h2 class="text-2xl md:text-3xl font-bold">{{grn.title}}</h2>
                <h2 class="text-lg text-secondary">
                    <small>for</small>
                    {{grn.supplier.name}}
                    <small>on</small>
                    {{grn.date_added | date}}
                </h2>
            </div>
        </div>

        <!-- GRN Items and Info -->
        <div class="flex flex-col items-center justify-start w-11/12 max-w-[700px] bg-light my-2 rounded-xl p-5">
            {% for item in grn.items.all %}
                <div
                    x-data="{showMore: false}"
                    class="flex flex-col w-full p-2"
                >
                    <h3 class="flex items-center font-bold text-xl">
                        <img
                            class="w-4 h-4 cursor-pointer transition-transform duration-300 ease-in-out"
                            :class="{ '-rotate-90': !showMore }"
                            @click="showMore = !showMore"
                            src="{% static 'img/expand.svg' %}" alt=""
                        >
                        <span class="py-2 ps-2">{{item.product.title}}</span>
                    </h3>
                    <table>
                        <tr>
                            <td class="w-1/3">LKR {{item.item_price|floatformat:2}}</td>
                            <td class="w-1/3 text-end">X {{item.opening_quantity}}</td>
                            <td class="w-1/3 text-end">LKR {{item.raw_total_price|floatformat:2}}</td>
                        </tr>
                        <tr x-show="showMore" x-cloak>
                            <td class="w-1/3"></td>
                            <td class="w-1/3 text-end">Flat Discount <small>on Total</small></td>
                            <td class="w-1/3 text-end">- LKR {{item.flat_discount_on_total|floatformat:2}}</td>
                        </tr>
                        <tr x-show="showMore" x-cloak>
                            <td class="w-1/3"></td>
                            <td class="w-1/3 text-end">Flat Discount <small>on Items</small></td>
                            <td class="w-1/3 text-end">- LKR {{item.flat_discount_on_items|floatformat:2}}</td>
                        </tr>
                        <tr x-show="showMore" x-cloak>
                            <td class="w-1/3"></td>
                            <td class="w-1/3 text-end">Percentage Discount <small>({{item.discount_percentage}}%)</small></td>
                            <td class="w-1/3 text-end">- LKR {{item.percentage_discount|floatformat:2}}</td>
                        </tr>
                        <tr x-show="showMore" x-cloak>
                            <td class="w-1/3"></td>
                            <td class="w-1/3 text-end">Free Items <small>({{item.discount_free_items}})</small></td>
                            <td class="w-1/3 text-end">- LKR {{item.free_items_discount|floatformat:2}}</td>
                        </tr>
                        <tr class="border-secondary border-b-2">
                            <td class="w-1/3"></td>
                            <td class="w-1/3 text-end font-bold">Sub Total</td>
                            <td class="w-1/3 text-end font-bold">LKR {{item.total_price|floatformat:2}}</td>
                        </tr>
                    </table>
                </div>
            {% endfor %}

            <!-- Add GRN -->
            <a href="{% url 'grn-items-create' grn.id %}" class="flex items-center justify-start w-full">
                <img class="w-6 h-6 m-3" src="/static/img/plus.svg" alt="">
                <h2 class="text-xl font-bold uppercase">Add GRN Item</h2>
            </a>
        </div>

        <!-- GRN Items and Info -->
        {% if grn.items.all.count %}
            <div class="flex flex-col items-center justify-start w-11/12 max-w-[700px] bg-light my-2 rounded-xl p-5">
                <div
                    class="flex flex-col w-full p-2"
                >
                    <h3 class="flex items-center font-bold text-xl text-center py-2">
                        GRN Summary
                    </h3>
                    <table>
                        <tr>
                            <td class="w-1/2 text-end">Total</td>
                            <td class="w-1/2 text-end">LKR {{grn.raw_total_price|floatformat:2}}</td>
                        </tr>
                        <tr>
                            <td class="w-1/2 text-end">Flat Discount <small>on Total</small></td>
                            <td class="w-1/2 text-end">- LKR {{grn.discount_flat|floatformat:2}}</td>
                        </tr>
                        <tr>
                            <td class="w-1/2 text-end">Percentage Discount <small>({{grn.percentage_discount}}%)</small></td>
                            <td class="w-1/2 text-end">- LKR {{grn.discount_percentage|floatformat:2}}</td>
                        </tr>
                        <tr class="mt-3">
                            <td class="w-1/2 text-end font-bold text-xl">Net Total</td>
                            <td class="w-1/2 text-end font-bold text-xl">LKR {{grn.total_price|floatformat:2}}</td>
                        </tr>
                    </table>
                </div>

                <!-- Finalize GRN -->
                <a
                    href="{% url 'grn-items-create' grn.id %}"
                    class="flex items-center justify-center w-full bg-primary rounded-lg text-light mt-3"
                >
                    <img class="w-6 h-6 m-3" src="/static/img/confirm-light.svg" alt="">
                    <h2 class="text-xl font-bold uppercase">Finalize GRN</h2>
                </a>

            </div>
        {% endif %}
    </div>

{% endblock %}